---
title: "GEOG 176A: Intro to GIS"
author: "[Ian Hinds](https://hindstein.github.io/GEOG176A/)"
subtitle: 'Lab 04: Tesselations, Point-in-polygon'
date: "31 August 2020"
output:
  html_document:
    theme: journal
---
## Background
In this lab we will an explore the impacts of tessellated surfaces and the modifiable areal unit problem (MAUP) using the National Dam Inventory maintained by the United States Army Corps of Engineers. Doing this will require repetitive tasks that we will write as functions and careful consideration of feature aggregation/simplification, spatial joins, and data visualization. The end goal is to visualize the distribution of dams and there purposes across the country.

*****

## Libraries
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
library(sf)
library(USAboundaries)
library(tidyverse)
```
*****
## Quesion 1: 
Prepare five tessellated surfaces from CONUS and write a function to plot them in a descriptive way.

### *Step 1.1 (CONUS Counties Spatial File)*
* get an sf object of US counties (USAboundaries::us_counties())
* remove those not in CONUS
* transform the data to EPSG:5070
```{r}
counties = USAboundaries::us_counties() %>%
  filter(!state_name %in% c("Hawaii",
                            "Alaska",
                            "Puerto Rico",
                            "Guam")) %>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326) %>%
  st_transform(5070)
```

### *Step 1.2 (Anchor Points for Triangle Tessellation)*
- generate county centroids using st_centroid
- combine POINT features into a single MULTIPOINT feature
- the difference between union/combine is mute
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
countycent = st_centroid(counties) 
countycent_c = st_combine(countycent)
```

### *Step 1.3 (Tile Shapes and Types)*
- Make a voroni tessellation over your county centroids (MULTIPOINT)
- Make a triangulated tessellation over your county centroids (MULTIPOINT)
- Make a gridded coverage with n = 70, over your counties object
- Make a hexagonal coverage with n = 70, over your counties object
- Add a new column to each tessellation that spans from 1:n().
- Coerse the sfc list into an sf object (st_sf or st_as_sf)
- Ensure that our surfaces are topologically valid/simple (pass our surfaces through st_cast)

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
# voroni tessellation
v_grid = st_voronoi(countycent_c) %>%
  st_cast() %>% 
  st_as_sf() %>% 
  mutate(id = 1:n())

# triangulated tesselation
tri_grid = st_triangulate(countycent_c) %>%
  st_cast() %>% 
  st_as_sf() %>% 
  mutate(id = 1:n())

# square (grid) tesselation
sqgrid = st_make_grid(counties, n=70) %>%
  st_cast() %>% 
  st_as_sf() %>% 
  mutate(id = 1:n())

# hexagonal tessellation
hexgrid = st_make_grid(counties, n=70, square=FALSE) %>%
  st_cast() %>%
  st_as_sf() %>%
  mutate(id = 1:n())
```

### *Step 1.4 (Plot Examples of Tessellations and Trim)*
- Plot all defined grids and cut regional boundaries to CONUS border

```{r}
# Voroni Grid
#plot(v_grid)

# Triangulated Grid
plot(tri_grid)

# Sqaure Grid
#plot(sqgrid)

# Hexagonal Grid
#plot(hexgrid)

# Cut county boundaries to CONUS border
countybound = st_filter(counties, countycent_c, .predicate = st_intersects) 
plot(countybound, max.plot = 12)

```

## *Step 1.5 (Simplify Geometry Points)*
- Use the Visvalingam algotithm provided by rmapshaper::ms_simplify.
- Choose what percentage of vertices to retain using the keep argument
- Use the mapview::npts function to report the number of points in the original object, and in the simplified object.
- How many points were you able to remove? What are the consequences of doing this computationally?

- Use your simplified object to crop the two triangulated tessellations with st_intersection:
